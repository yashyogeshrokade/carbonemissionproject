<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Energy Consumption Details</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">

  <div class="bg-red-800 text-white text-center py-5 text-3xl font-bold shadow-md">
    Energy Consumption Details
  </div>

  <div class="flex justify-center mt-8">
    <div class="bg-white shadow-lg rounded-2xl p-8 w-full max-w-3xl text-center">
      <h2 id="buildingName" class="text-2xl font-semibold text-red-800 mb-4"></h2>
      <canvas id="energyChart" height="120"></canvas>
      <p id="total" class="mt-6 text-lg font-bold text-red-700"></p>
      <button onclick="history.back()" class="mt-8 bg-red-800 text-white px-6 py-2 rounded-lg hover:bg-red-700">‚Üê Back</button>
    </div>
  </div>

  <script>
    // Get the selected building data from localStorage
    const building = JSON.parse(localStorage.getItem("selectedBuilding"));

    if (!building) {
      document.body.innerHTML = `
        <div class="text-center mt-20 text-red-700 text-xl">
          Error loading data. Please go back and select a building again.
        </div>`;
    } else {
      // Use correct key name from Excel
      const name = building["Building Name"] || building["Building"] || "Unknown";

      document.getElementById("buildingName").textContent = name;

      // Extract monthly data (columns with -25)
      const months = Object.keys(building).filter(k => k.includes("-25"));
      const values = months.map(m => Number(building[m]) || 0);

      // Create chart
      const ctx = document.getElementById("energyChart").getContext("2d");
      new Chart(ctx, {
        type: "bar",
        data: {
          labels: months,
          datasets: [{
            label: "Electricity Consumption (kWh)",
            data: values,
            backgroundColor: "#8B1C1C",
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            title: {
              display: true,
              text: "Monthly Electricity Consumption",
              color: "#8B1C1C",
              font: { size: 16, weight: "bold" }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: "Consumption (kWh)" }
            },
            x: {
              title: { display: true, text: "Month" }
            }
          }
        }
      });

      // Display total
      const total = building["Total"] || building["TOTAL"] || 0;
      document.getElementById("total").textContent = `Total Consumption: ${total} kWh`;
    }
  </script>

</body>
</html>
